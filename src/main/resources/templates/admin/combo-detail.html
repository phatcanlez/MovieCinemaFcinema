<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Combo Details</title>
    <link rel="stylesheet" th:href="@{/css/admin/promotion-detail.css}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link rel="stylesheet" th:href="@{/css/admin/admin-mainlayout.css}" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <div
      th:replace="~{adminLayout/navbar :: adminNavbar(activePage='combos')}"
    ></div>
    <div class="main-content">
      <div class="container mt-4">
        <div class="back-link mb-4">
          <a th:href="@{/admin/combo-management}" class="back-link">
            <i class="fas fa-arrow-left"></i> Back
          </a>
        </div>
        <h2 class="promotion-title mb-4" th:text="${combo.comboName}">
          Combo Details
        </h2>

        <!-- Alert messages for success/error -->
        <div
          th:if="${successMessage}"
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <span th:text="${successMessage}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        <div
          th:if="${errorMessage}"
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <span th:text="${errorMessage}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>

        <div class="card">
          <div class="card-body">
            <form
              id="comboForm"
              th:action="@{/admin/combo-management/update}"
              method="post"
              enctype="multipart/form-data"
            >
              <div class="row">
                <div class="col-md-6">
                  <!-- Image section -->
                  <div class="text-center mb-4">
                    <img
                      th:if="${combo.imageUrl != null && !combo.imageUrl.isEmpty()}"
                      th:src="${combo.imageUrl}"
                      alt="Combo Image"
                      class="promotion-image mb-3"
                      id="comboImage"
                    />
                    <div
                      th:if="${combo.imageUrl == null || combo.imageUrl.isEmpty()}"
                      class="no-image-placeholder"
                    >
                      <i class="fas fa-image"></i>
                      <p>No image available</p>
                    </div>
                  </div>

                  <!-- Image upload - visible only in edit mode -->
                  <div id="editImageGroup" class="mb-3" style="display: none">
                    <label for="comboImageInput" class="form-label"
                      >Upload New Image</label
                    >
                    <input
                      type="file"
                      class="form-control"
                      id="comboImageInput"
                      name="image"
                      accept="image/*"
                    />
                  </div>
                </div>

                <div class="col-md-6">
                  <input
                    type="hidden"
                    name="comboId"
                    th:value="${combo.comboId}"
                  />

                  <div class="mb-3">
                    <label class="form-label">Combo ID</label>
                    <input
                      type="text"
                      class="form-control"
                      th:value="${combo.comboId}"
                      readonly
                    />
                  </div>

                  <div class="mb-3">
                    <label for="comboName" class="form-label">Combo Name</label>
                    <input
                      type="text"
                      class="form-control"
                      id="comboName"
                      name="comboName"
                      th:value="${combo.comboName}"
                      readonly
                      required
                    />
                  </div>

                  <div class="mb-3">
                    <label for="description" class="form-label"
                      >Description</label
                    >
                    <textarea
                      class="form-control"
                      id="description"
                      name="description"
                      rows="3"
                      readonly
                    >
<th:block th:text="${combo.description}"></th:block></textarea
                    >
                  </div>

                  <!-- Price information -->
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="price" class="form-label">Price (VND)</label>
                      <input
                        type="number"
                        class="form-control"
                        id="price"
                        name="price"
                        th:value="${combo.price}"
                        min="0"
                        readonly
                        required
                      />
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="discountPercentage" class="form-label"
                        >Discount (%)</label
                      >
                      <input
                        type="number"
                        class="form-control"
                        id="discountPercentage"
                        name="discountPercentage"
                        th:value="${combo.discountPercentage}"
                        min="0"
                        max="100"
                        readonly
                        required
                      />
                    </div>
                  </div>

                  <!-- Status information -->
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="comboStatus" class="form-label"
                        >Hot Status</label
                      >
                      <select
                        class="form-control"
                        id="comboStatus"
                        name="comboStatus"
                        disabled
                        required
                      >
                        <option
                          value="NORMAL"
                          th:selected="${combo.comboStatus == 'NORMAL'}"
                        >
                          Normal
                        </option>
                        <option
                          value="HOT"
                          th:selected="${combo.comboStatus == 'HOT'}"
                        >
                          Hot
                        </option>
                      </select>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="active" class="form-label">Status</label>
                      <div class="form-check form-switch">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="active"
                          name="active"
                          th:checked="${combo.active}"
                          disabled
                        />
                        <label class="form-check-label" for="active">
                          <span th:if="${combo.active}" class="text-success"
                            >Active</span
                          >
                          <span th:unless="${combo.active}" class="text-danger"
                            >Inactive</span
                          >
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- View Mode Buttons -->
                  <div class="d-flex justify-content-between mt-4">
                    <div id="viewButtons">
                      <button
                        type="button"
                        class="btn btn-warning me-2"
                        onclick="enableEditMode()"
                      >
                        <i class="fas fa-edit"></i> Edit
                      </button>
                      <button
                        type="button"
                        class="btn btn-info me-2"
                        onclick="toggleStatus()"
                      >
                        <i class="fas fa-sync-alt"></i>
                        <span th:if="${combo.active}">Deactivate</span>
                        <span th:unless="${combo.active}">Activate</span>
                      </button>
                    </div>
                  </div>

                  <!-- Edit Mode Buttons -->
                  <div id="editButtons" class="mt-4" style="display: none">
                    <button type="submit" class="btn btn-success me-2">
                      <i class="fas fa-save"></i> Save
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      onclick="cancelEdit()"
                    >
                      <i class="fas fa-times"></i> Cancel
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Toggle Status Form -->
    <form
      id="toggleStatusForm"
      th:action="@{/admin/combo-management/toggle-status}"
      method="post"
      style="display: none"
    >
      <input type="hidden" name="comboId" th:value="${combo.comboId}" />
    </form>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script th:src="@{/js/admin/combo-detail.js}"></script>
  </body>
</html>

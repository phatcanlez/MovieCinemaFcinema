<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FCinema - Booking Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" th:href="@{/css/admin/admin-mainlayout.css}" />
    <style>
        .main-content {
            flex-grow: 1;
        }

        .table th,
        .table td {
            vertical-align: middle;
        }

        .badge-status {
            font-size: 1em;
        }

        .modal-content {
            border: 1px solid #333;
        }

        .form-text {
            color: #aaa !important;
        }

        .search-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-section form {
            margin-bottom: 0;
        }

        /* Loading animation */
        .loading-cell {
            text-align: center;
            padding: 2rem;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #dc3545;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Pagination styling giống movie-management */
        .pagination {
            margin-bottom: 0;
        }

        .page-link {
            color: #dc3545;
        }

        .page-item.active .page-link {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .page-link:hover {
            color: #fff;
            background-color: #dc3545;
            border-color: #dc3545;
        }
    </style>
</head>

<body>
    <div class="d-flex">
        <!-- Include navbar with active page set to 'bookings' -->
        <div th:replace="~{adminLayout/navbar :: adminNavbar('tickets')}"></div>

        <!-- Main Content -->
        <div class="main-content p-4 flex-grow-1">
            <h2 class="text-danger">
                <i class="fas fa-receipt me-2"></i>Booking Management
            </h2>
            <!-- Thông báo thành công/lỗi -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <!-- Search & Filter Section -->
            <div class="card-body">
                <div class="search-section mb-4">
                    <form class="d-flex" id="searchForm">
                        <div class="input-group me-2" style="width: 400px">
                            <input type="text" class="form-control" id="searchInput"
                                placeholder="Enter Booking ID, Movie, Room..." />
                            <button class="btn btn-danger" type="submit">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                        <select class="form-select me-2" id="statusFilter" style="width: 120px">
                            <option value="">All Status</option>
                            <option value="PENDING">Pending</option>
                            <option value="SUCCESS">Success</option>
                            <option value="CANCELLED">Cancelled</option>
                        </select>
                    </form>
                </div>

                <!-- Booking Statistics Cards -->
                <div class="row">
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-primary text-white mb-4">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title mb-0">Total Bookings</h5>
                                    <h2 class="mt-2 mb-0" id="totalBookings">0</h2>
                                </div>
                                <i class="fas fa-ticket-alt fa-3x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-success text-white mb-4">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title mb-0">Completed</h5>
                                    <h2 class="mt-2 mb-0" id="completedBookings">0</h2>
                                </div>
                                <i class="fas fa-check-circle fa-3x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-warning text-white mb-4">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title mb-0">Pending</h5>
                                    <h2 class="mt-2 mb-0" id="pendingBookings">0</h2>
                                </div>
                                <i class="fas fa-clock fa-3x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-danger text-white mb-4">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title mb-0">Cancelled</h5>
                                    <h2 class="mt-2 mb-0" id="cancelledBookings">0</h2>
                                </div>
                                <i class="fas fa-times-circle fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Table -->
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped align-middle">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Movie</th>
                                    <th>Show Date</th>
                                    <th>Show Time</th>
                                    <!-- <th>Room</th> -->
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="bookingTableBody">
                                <!-- Loading state ban đầu -->
                                <tr id="loadingRow">
                                    <td colspan="8" class="loading-cell">
                                        <div class="loading-spinner"></div>
                                        <div>Loading bookings...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Phần phân trang giống movie-management -->
                    <nav aria-label="Page navigation" id="paginationContainer" style="display: none">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Nút phân trang sẽ được thêm bằng JavaScript -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Booking Details Modal -->
        <div class="modal fade" id="bookingDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-ticket-alt me-2"></i>Booking Details
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card h-100 shadow-sm border-0">
                                    <div class="card-header bg-white border-bottom">
                                        <h6 class="card-title mb-0 text-primary">
                                            <i class="fas fa-info-circle me-2"></i>Booking Information
                                        </h6>
                                    </div>
                                    <div class="card-body bg-white">
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Booking ID:</strong></div>
                                            <div class="col-7">
                                                <span id="modalBookingId" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Booking Date:</strong></div>
                                            <div class="col-7">
                                                <span id="modalBookingDate" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Status:</strong></div>
                                            <div class="col-7">
                                                <span id="modalStatus" class="badge"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Payment Method:</strong></div>
                                            <div class="col-7">
                                                <span id="modalPaymentMethod" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-5"><strong>Total Amount:</strong></div>
                                            <div class="col-7">
                                                <span id="modalTotalAmount" class="text-success fw-bold fs-5"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100 shadow-sm border-0">
                                    <div class="card-header bg-white border-bottom">
                                        <h6 class="card-title mb-0 text-primary">
                                            <i class="fas fa-user me-2"></i>Customer Information
                                        </h6>
                                    </div>
                                    <div class="card-body bg-white">
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Name:</strong></div>
                                            <div class="col-7">
                                                <span id="modalCustomerName" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Email:</strong></div>
                                            <div class="col-7">
                                                <span id="modalCustomerEmail" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Phone:</strong></div>
                                            <div class="col-7">
                                                <span id="modalCustomerPhone" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-5"><strong>Member Points:</strong></div>
                                            <div class="col-7">
                                                <span id="modalCustomerPoints" class="text-warning fw-bold"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card shadow-sm border-0">
                            <div class="card-header bg-white border-bottom">
                                <h6 class="card-title mb-0 text-primary">
                                    <i class="fas fa-film me-2"></i>Ticket Information
                                </h6>
                            </div>
                            <div class="card-body bg-white">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Movie:</strong></div>
                                            <div class="col-7">
                                                <span id="modalMovie" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Show Date:</strong></div>
                                            <div class="col-7">
                                                <span id="modalShowDate" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Show Time:</strong></div>
                                            <div class="col-7">
                                                <span id="modalShowTime" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-5"><strong>Room:</strong></div>
                                            <div class="col-7">
                                                <span id="modalRoom" class="text-dark"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Seats:</strong></div>
                                            <div class="col-7">
                                                <span id="modalSeats" class="text-dark"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Ticket Price:</strong></div>
                                            <div class="col-7">
                                                <span id="modalTicketPrice" class="text-success"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Food & Beverage:</strong></div>
                                            <div class="col-7">
                                                <span id="modalFoodPrice" class="text-info"></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-5">
                                                <strong>Discount Applied:</strong>
                                            </div>
                                            <div class="col-7">
                                                <span id="modalDiscount" class="text-danger"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <hr class="my-3" />

                                <div class="row">
                                    <div class="col-12">
                                        <h6 class="text-primary mb-3">
                                            <i class="fas fa-utensils me-2"></i>Food & Beverage
                                            Details
                                        </h6>
                                        <div class="bg-light p-3 rounded">
                                            <ul id="modalFoodList" class="list-unstyled mb-0">
                                                <!-- Will be populated by JavaScript -->
                                            </ul>
                                        </div>

                                        <!-- Container cố định cho promotion và points -->
                                        <div id="promotionPointsContainer">
                                            <!-- Promotion và Points info sẽ được thêm ở đây -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-top">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i>Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script th:src="@{/js/admin/admin-ticket.js}"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xác Nhận & Thanh Toán - FCine</title>
    <link
      rel="icon"
      href="https://res.cloudinary.com/thaidev/image/upload/v1752116653/favicon_ij2fnu.png"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/payment.css}" />
    <link rel="stylesheet" th:href="@{/css/seat-selection.css}" />
  </head>

  <body>
    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">
          Đang xử lý thanh toán...
        </div>
        <div class="loading-subtext" id="loadingSubtext">
          Vui lòng không đóng trang này
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1 class="page-title">
          <i class="bi bi-check2-square"></i>
          Xác Nhận & Thanh Toán
        </h1>
        <p class="page-subtitle">
          Vui lòng kiểm tra thông tin và hoàn tất thanh toán
        </p>
      </div>

      <div class="main-content">
        <!-- Left Content -->
        <div class="content-section">
          <!-- Movie Information -->
          <div class="section-title">
            <i class="bi bi-film"></i>
            Thông Tin Phim
          </div>

          <div class="movie-card">
            <div class="movie-poster">
              <img src="" alt="" id="movie-poster-img" />
            </div>
            <div class="movie-details">
              <h3 id="movie-title"></h3>
              <div class="movie-meta">
                <div id="movie-showtime">
                  <i class="bi bi-calendar3"></i> <span></span>
                </div>
                <div id="movie-room">
                  <i class="bi bi-geo-alt"></i> <span></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Booking Details -->
          <div class="section-title">
            <i class="bi bi-ticket-detailed"></i>
            Chi Tiết Đặt Vé
          </div>
          <div class="booking-card">
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Ngày & giờ chiếu</span>
                <span class="info-value" id="showtime-info"></span>
              </div>
              <div class="info-item">
                <span class="info-label">Phòng chiếu</span>
                <span class="info-value" id="room-info"></span>
              </div>
              <div class="info-item">
                <span class="info-label">Số lượng ghế</span>
                <span class="info-value" id="seat-count"></span>
              </div>
              <div class="info-item">
                <span class="info-label">Ghế đã chọn</span>
                <div class="info-value">
                  <div class="seats-display" id="selected-seats"></div>
                </div>
              </div>
              <div
                class="info-item"
                id="combo-info-section"
                style="display: none"
              >
                <span class="info-label">Combo đã chọn</span>
                <div class="info-value">
                  <div class="combo-display" id="selected-combos"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Panel -->
        <div class="payment-panel">
          <!-- Timer -->
          <div class="timer-section">
            <div class="timer" id="paymentTimer"></div>
            <div class="timer-label">Thời gian thanh toán còn lại</div>
          </div>

          <div class="panel-title">
            <i class="bi bi-receipt"></i>
            Thông Tin Thanh Toán
          </div>

          <!-- Payment Method Display -->
          <div class="price-breakdown">
            <div class="payment-method-title">
              <i class="bi bi-credit-card"></i>
              Phương thức thanh toán
            </div>

            <!-- MoMo Payment Display -->
            <div class="payment-option active" data-method="MOMO">
              <div class="payment-logo">
                <img
                  src="https://developers.momo.vn/v3/vi/assets/images/transparent-background-logo-138ebf0ffca865ec0f1a7d9c1e4a9f3c.png"
                  alt="MoMo"
                />
              </div>
              <div class="payment-info">
                <h4>Ví điện tử MoMo</h4>
                <p>Thanh toán nhanh chóng và bảo mật với MoMo</p>
              </div>
              <div class="payment-check">
                <i class="bi bi-check"></i>
              </div>
            </div>

            <!-- Points Section -->
            <div
              class="points-section"
              style="
                margin-top: 20px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 15px;
              "
            >
              <div
                class="payment-method-title"
                style="margin-bottom: 15px; font-size: 14px"
              >
                <i class="bi bi-star-fill" style="color: #fbbf24"></i>
                Điểm tích lũy của bạn
              </div>

              <div
                class="points-info"
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 15px;
                "
              >
                <span style="color: #ccc; font-size: 14px">Điểm hiện có:</span>
                <span
                  id="userPoints"
                  style="color: #fbbf24; font-weight: bold; font-size: 16px"
                  >0 điểm</span
                >
              </div>

              <div
                class="points-usage"
                style="
                  display: flex;
                  align-items: center;
                  gap: 10px;
                  margin-bottom: 10px;
                "
              >
                <input
                  type="checkbox"
                  id="usePointsCheckbox"
                  style="transform: scale(1.2); accent-color: #dc2626"
                />
                <label
                  for="usePointsCheckbox"
                  style="color: #fff; font-size: 14px; cursor: pointer"
                >
                  Sử dụng điểm để giảm giá
                </label>
              </div>

              <div
                id="pointsDetails"
                style="font-size: 12px; color: #999; line-height: 1.4"
              >
                <div style="margin-bottom: 5px">• 1 điểm = 10đ</div>
                <div style="margin-bottom: 5px">
                  • Tối đa giảm 30% giá trị đơn hàng
                </div>
                <div>
                  • Tối đa sử dụng
                  <span
                    id="maxUsablePoints"
                    style="color: #fbbf24; font-weight: bold"
                  ></span>
                  điểm cho đơn hàng này
                </div>
              </div>
            </div>
          </div>

          <div class="mb-3" style="margin-top: 10px">
            <label
              for="promoCode"
              style="color: #fbbf24; font-size: 14px; font-weight: 600"
              >Mã khuyến mãi</label
            >
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="promoCode"
                placeholder="Nhập mã giảm giá..."
                style="
                  background: rgba(255, 255, 255, 0.08);
                  color: #fff;
                  border: 1px solid #fbbf24;
                "
              />
              <button
                class="btn btn-warning"
                type="button"
                id="applyPromoBtn"
                style="font-weight: 600"
              >
                Áp dụng
              </button>
            </div>
          </div>
          <div class="total-section">
            <div
              class="price-item"
              id="seat-price-display"
              style="font-size: 14px; color: #ccc; margin-bottom: 8px"
            >
              <span>Vé phim:</span>
              <span id="seat-price">0đ</span>
            </div>
            <div
              class="price-item"
              id="combo-price-display"
              style="font-size: 14px; color: #ccc; margin-bottom: 8px"
            >
              <span>Combo:</span>
              <span id="combo-price">0đ</span>
            </div>
            <div class="total-price">
              <span>Tổng thanh toán</span>
              <span id="totalAmount"></span>
            </div>
          </div>

          <!-- Payment Button -->
          <button
            class="confirm-btn momo-btn"
            id="confirmPaymentBtn"
            style="transition: background 0.2s"
          >
            <i class="bi bi-wallet2" id="payment-icon"></i>
            <span id="payment-text">Thanh toán bằng MoMo</span>
          </button>
        </div>
      </div>
    </div>
    <script th:src="@{/js/payment.js}"></script>
  </body>
</html>
